{% extends "base.html" %}

{% block title -%} Vote {%- endblock %}

{% block head -%}
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js" integrity="sha256-ymhDBwPE9ZYOkHNYZ8bpTSm1o943EH2BAOWjAQB+nm4=" crossorigin="anonymous"></script>
<script defer>
document.addEventListener("DOMContentLoaded", function() {
const svg = `<svg style="display:inline" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 10h16M4 14h16M9 18l3 3l3-3M9 6l3-3l3 3"/></svg>`;

function setup() {
    document.querySelectorAll("span.sort-icon").forEach(s => s.innerHTML = svg);

    const form = document.getElementById("sortable");
    const sortable=new Sortable(form, {
        animation: 150,
        ghostClass: "blue-background-class",

        // Make the `.htmx-indicator` unsortable
        filter: ".htmx-indicator",
        onMove: function (evt) {
            return evt.related.className.indexOf('htmx-indicator') === -1;
        },

        // Disable sorting on the `end` event
        onEnd: function (evt) {
            this.option("disabled", true);
        }
    });

    // Re-enable sorting on the `htmx:afterSwap` event
    form.addEventListener("htmx:afterSwap", function() {
        document.querySelectorAll("span.sort-icon").forEach(s => s.innerHTML = svg);

        sortable.option("disabled", false);
    });
};
setup();
});
</script>
<style>
   @keyframes fade-in {
     from { opacity: 0; }
   }

   @keyframes fade-out {
     to { opacity: 0; }
   }

   @keyframes slide-from-top {
     from { transform: translateY(90px); }
   }

   @keyframes slide-to-bottom {
     to { transform: translateY(-90px); }
   }

   main {
     view-transition-name: slide-it;
   }

   ::view-transition-old(slide-it) {
     animation: 180ms cubic-bezier(0.4, 0, 1, 1) both fade-out,
     600ms cubic-bezier(0.4, 0, 0.2, 1) both slide-to-bottom;
   }
   ::view-transition-new(slide-it) {
     animation: 420ms cubic-bezier(0, 0, 0.2, 1) 90ms both fade-in,
     600ms cubic-bezier(0.4, 0, 0.2, 1) both slide-from-top;
   }
</style>
<script defer type="module">
import confetti from "https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/+esm";
window.confetti = () => {
    confetti({
        angle: 60,
        origin: { x: 0 },
    });
    confetti({
        angle: 120,
        origin: { x: 1 },
    });
};
</script>
{%- endblock %}

{% block content %}
<main class="w-48">
    <div class="text-center text-xl"></div>
    <form id="sortable" hx-post="/vote" hx-trigger="end">
        {{ sortable|safe }}
    </form>

    <button class="bg-green-800 hover:bg-green-700 hover:text-white hover:shadow-lg hover:shadow-green-700/20 stroke-white rounded-lg shadow my-6 p-4 w-full"
        hx-post="/vote/submit" hx-include="#sortable" hx-target="main" hx-swap="innerHTML transition:true">
        Lead√°s
    </button>

    <a href="/" hx-boost="true" class="hover:underline text-center w-full inline-block">Vissza</a>
</main>
{% endblock content %}

{# vim: set ft=htmldjango: #}
